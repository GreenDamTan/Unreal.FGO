location.hash&&0<=location.hash.indexOf("page=")&&(location.href="index_"+location.hash.match(/page=([\d]*)/)[1]+".html"+location.hash);function __updateLoginSta(b){document.getElementById("_userlogin").innerHTML=b}var VideoPart={nodedata:[],tempParts:null,listId:"#alist, #plist",collapse:function(u){var t=document.getElementById("dedepagetitles"),s=this.nodedata,r=this,q=0,o,p=0;u=u||window.pageno;null==t?t=this.tempParts:this.tempParts=t;if(t){for(o=0;o<t.length;o++){s[q++]=[$(t.options[o]).html(),$(t.options[o]).val()]}t=$(this.listId).empty().removeClass().addClass("plist-content");u=parseInt(u)||1;var n=0,m,j;for(o=3<q?u-2:0;o<u+5&&!(void 0!==s[o]&&(j=o==u-1?$('<span class="curPage">'+s[o][0]+"</span>\n"):$('<a href="'+s[o][1]+'">'+s[o][0]+"</a>\n"),m=r.caculate(j),m>n&&(n=m),t.append(j),p++,p>=this._getCol(n)));o++){}if(q>p){$('<a class="v-part-toggle">\u5c55\u5f00</a>').appendTo(t).on("click",function(){r.expand(u)})}t.addClass("p-c"+p);this._bindTitle(t.children().not(".v-part-toggle, .p-close"));this.copyright()}},expand:function(g){var f=$(this.listId),k=this.nodedata,j=this;f.addClass("open").empty();for(i=0;i<k.length;i++){i==g-1?f.append('<span class="curPage">'+k[i][0]+"</span>\n"):f.append('<a href="'+k[i][1]+'">'+k[i][0]+"</a>\n")}this.setView($(this.listId));f.height();var h=$('<div class="p-close">\u6536\u8d77</div>').appendTo(f).on("click",function(){$(window).off("scroll.p-close");j.collapse(g);f.offset().top<$(window).scrollTop()&&$(window).scrollTop($(".viewbox").offset().top)});$(window).on("scroll.p-close",function(){if(20>f.offset().top-$(window).scrollTop()){var b=$(window).scrollTop()-f.offset().top+20;b<f.outerHeight()-h.outerHeight()-20?h.css("top",b):h.css("top",f.height()-h.outerHeight()-20)}else{h.css("top",0)}})},setView:function(f){var e=$(this.listId);e.width();var h=this,g=0;f=f.children().not(".v-part-toggle, .p-close");f.each(function(d,c){var j=$(c),j=h.caculate(j);j>g&&(g=j)});e.removeClass("p-c3, p-c4, p-c5, p-c6, p-c7").addClass("p-c"+this._getCol(g));this._bindTitle(f)},_bindTitle:function(d){var c=this;d.hover(function(){var b=$(this);if(!(b.outerWidth()>=c.caculate(b))){var e=$('<div class="p-float-txt"></div>');e.html(b.text());e.appendTo("body");e.css({top:b.offset().top-e.outerHeight()-8,left:b.offset().left});e.animate({top:"+=5",opacity:1})}},function(){$(".p-float-txt").remove()})},_getCol:function(b){return 255<=b?3:200<=b?4:163<=b?5:137<=b?6:7},caculate:function(d){d=$("<div>").html(d.html()).css({position:"absolute",top:0,left:0,"line-height":d.css("line-height"),visibility:"hidden","white-space":"nowrap","padding-left":d.css("padding-left"),"padding-right":d.css("padding-right"),border:"1px solid transparent"}).appendTo("body");$(this.listId).width();var c;c=d.outerWidth();d.remove();return c},copyright:function(){function k(){$(j.children()[0]).remove();j.children().each(function(e,d){d=$(d);var f=d.html();d.html(f.replace(/.*\u3001/,""))});j.find(".curPage").prependTo(j)}var j=$(this.listId),q=this.nodedata,p=JSON.parse(ChatGetSettings("cp_bangumi_record"));null==p&&(p={});var o=$("#bofqi"),m=!1,n=o.html().match(/\[\[(.*)\]\]/)||$(j.children()[0]).html().match(/\[\[(.*)\]\]/);if(null!=n&&"undefined"!=typeof n[1]&&"copyright"==n[1]||"undefined"!=typeof p[aid]){m=!0}if(m){if(j.delegate("a","click",function(){if(!$(this).attr("id")){var d=p[aid],c;d:{c=$(this);for(var f=0;f<q.length;f++){if(c.attr("href")==q[f][1]){c=f;break d}}c=void 0}d.p=c+1;ChatSaveSettings("cp_bangumi_record",JSON.stringify(p))}}),1<q.length&&(0>location.href.indexOf("index_")||0<=location.href.indexOf("index_1"))){if(o.hide(),o.html(),o.empty(),j.hide(),"undefined"!=typeof p[aid]){location.href="/video/av"+aid+"/index_"+p[aid].p+".html"}else{p[aid]={};o=$('<div class="player-placeholder"><div class="btn-wrapper"><div class="player-placeholder-head">\u8bf7\u9009\u62e9\u89c6\u9891\u6e90</div></div></div>').insertAfter(o).find(".btn-wrapper");m=5<q.length?4:q.length-1;for(n=0;n<m;n++){2==m?o.addClass("n2"):3==m?o.addClass("n3"):4<=m&&o.addClass("n4");var l=$('<div class="src-btn"><a href="'+q[n+1][1]+'">'+q[n+1][0].replace(/.*\u3001/,"")+"</a></div>").appendTo(o);(function(b){l.click(function(){p[aid].p=b+2;ChatSaveSettings("cp_bangumi_record",JSON.stringify(p))})})(n)}k()}}else{1<q.length&&0<=location.href.indexOf("index_")&&(3<q.length&&this.expand(),k())}}}},js_viewallalist=utils.bindFn(VideoPart.collapse,VideoPart),kwtags=function(){};function callSpecPart(f,e){var h=VideoPart.nodedata;if(f&&totalpage&&null!=h&&0<f){if(f<=totalpage&&f<=h.length&&(void 0==top.allowSwitchPart||top.allowSwitchPart)){if("undefined"!=typeof e&&e){window.location.hash="#page="+f;VideoPart.collapse(f);var h=$("#qr_code"),g=location.href.match(/.*av[\d]*/)+"/index_"+f+".html";h.empty().qrcode($.extend(h.data("qrcode"),{text:g}));lrurl(window.aid,f,g)}else{window.location=h[f-1][1]}}else{void 0!=window.parent.callNextSpec&&window.parent.callNextSpec()}}}function callNextPart(b){window.pageno++;callSpecPart(parseInt(window.pageno),b)}function lrurl(e,d,f){e=e||window.aid;d=d||window.pageno;f=f||window.location.href;$("#link1").val("http://static.hdslb.com/miniloader.swf?aid="+e+"&page="+d);$("#link2").val('<embed height="415" width="544" quality="high" allowfullscreen="true" type="application/x-shockwave-flash" src="http://static.hdslb.com/miniloader.swf" flashvars="aid='+e+"&page="+d+'" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"></embed>');$("#link0").val(f);e=$("#btn_weixin .qr-code");e.empty().qrcode($.extend(e.data("qrcode"),{text:f}));f=$("#plist .curPage");f.length?$("#qr_description").html(f.html()):$("#qr_description").html("")}function copy_clip(f){if(window.clipboardData){window.clipboardData.setData("Text",f)}else{if(window.netscape){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var e=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!e){return}var h=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!h){return}h.addDataFlavor("text/unicode");var g={},g=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);g.data=f;h.setTransferData("text/unicode",g,2*f.length);if(!e){return !1}e.setData(h,null,Components.interfaces.nsIClipboard.kGlobalClipboard)}}return !1}function showVideoInfo(b){$(b).find("img").attr("src",$(b).find("img").attr("_src"));$(b).find("img").css("top",$(b).position().top+18);$(b).find("img").css("left",630<$(b).position().left?630:$(b).position().left);$(b).find("img").css("position","absolute");$(b).find("img").css("display","block")}function hideVideoInfo(b){$(b).find("img").hide()}function player_fullwin(f){!1==f&&$("#bofqi").removeClass("wide");if(!1!=f||null!==ff_embed_stack){if(null===ff_embed_stack){ff_embed_stack=[];ff_embed_stack_style=[];var e=$("#bofqi").get(0);do{$(e).attr("embed_stack",!0),ff_embed_stack.push(e)}while(e=e.parentNode)}f?($(".rklist").hide(),$("#bofqi").addClass("webfullscreen")):($(".rklist").show(),$("#bofqi").removeClass("webfullscreen"));var e=$("div").not("#bofqi div"),h;for(h in e){if(e[h]&&e[h].getAttribute&&!e[h].getAttribute("embed_stack")&&e[h]&&e[h].style){var g;e[h].getAttribute("ff_id")?g=ff_status[e[h].getAttribute("ff_id")]:(ff_status_id++,e[h].setAttribute("ff_id",ff_status_id),ff_status[ff_status_id]=e[h].style.display);e[h].style.display=f?"none":g}}for(h in ff_embed_stack){(e=ff_embed_stack[h])&&e.style&&(ff_embed_stack_style[h]||(ff_embed_stack_style[h]={position:e.style.position,width:e.style.width,height:e.style.height,padding:e.style.padding,margin:e.style.margin,style:e.style.cssText}),f?(e.style.position="fixed",e.style.width="100%",e.style.height="100%",e.style.padding="0 0",e.style.margin="0 0"):e.style.cssText=ff_embed_stack_style[h].style)}f||(ff_embed_stack=null)}}var ff_status={},ff_status_id=0,ff_embed_stack=null,ff_embed_stack_style=null;function player_widewin(){$("#bofqi").removeClass("webfullscreen");$("#bofqi").addClass("wide")}function loadco(){clearInterval(int_fblogin);"undefined"!=typeof AjaxPage&&AjaxPage(1)}function flv_checkLogin(){return void 0!==GetCookie("DedeUserID")&&GetCookie("DedeUserID")?!0:!1}function checkBrowser(){$.browser.mozilla||$("#browser_tips").length||(tips_str='<div class="ui-widget" id="browser_tips" style="margin:0px;">   <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">            <ul id="icons" class="ui-widget ui-helper-clearfix" style="width:19px;float:right">               <li class="ui-state-default ui-corner-all" style="cursor:pointer;" onclick="$(\'#browser_tips\').toggle( \'fold\', {}, 500 );"><span class="ui-icon ui-icon-closethick"></span></li>            </ul>       <p id="browser_tips_msg"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;margin-top:.1em;"></span></p>   </div></div>',$.browser.webkit&&navigator.userAgent.match(/(chrome)[ \/]([\w.]+)/i))}var autofresh_interval=null;function init_autofresh(d,c){autofresh_interval=setInterval(function(){var a=document.createElement("script");a.src="/plus/count.php?papa=yes&reload="+Math.random()+"&aid="+d+"&mid="+c;a.type="text/javascript";a.language="javascript";document.body.appendChild(a)},30000)}function heimu(d,c){$("#heimu");0==c?($("#heimu").hide(),$("#bofqi").removeClass("heimu")):($("#bofqi").addClass("heimu"),$("#heimu").css("opacity","."+d/10),$("#heimu").css("filter","alpha(opacity="+d+")"),$("#heimu").show())}function flashChecker(){var f,e=!1,h=0;if(navigator.plugins&&0<navigator.plugins.length&&(f=navigator.plugins["Shockwave Flash"])){e=!0;f=f.description.split(" ");for(var g=0;g<f.length;++g){isNaN(parseInt(f[g]))||(h=parseInt(f[g]))}}return{hasFlash:e,flashVersion:h}}function loadHTML5(g,f){var k=null!=navigator.userAgent.match(/iPad/i)||null!=navigator.userAgent.match(/iPhone/i)||null!=navigator.userAgent.match(/iPod/i),j=null!=navigator.userAgent.match(/Android/i);if(!flashChecker().hasFlash&&(k||j)){var h=1==Number(f)?"":"#page="+f;!/iPad/.test(navigator.userAgent)&&"#html5"!=location.hash||"YESYESYES"==ChatGetSettings("bilibililover")?__GetCookie("nmr")&&"0"!=__GetCookie("nmr")||window.location.replace("/mobile/video/av"+g+".html"+h):$.getJSON("/m/html5?aid="+g+"&page="+f+"&sid="+__GetCookie("sid"),function(a){"undefined"==typeof a.src?window.location.replace("http://m.acg.tv/video/av"+g+".html"+h):(window.html5data=a,$("#bofqi").html('<link type="text/css" href="http://static.hdslb.com/css/simple.v2.min.css" rel="stylesheet" />'),$.getScript("http://static.hdslb.com/js/simple.v2.min.js",function(){(new BiliH5Player).create({get_from_local:!0,comment:window.html5data.cid,image:window.html5data.img,video_url:window.html5data.src})}),$("#bofqi").prepend('<div class="main-inner"><div class="app-banner"><div class="app-banner-left"><div class="app-banner-title">\u4e0abilibili\u5ba2\u6237\u7aef</div><div class="app-banner-content">\u9ad8\u6e05\u52a8\u753b \u79bb\u7ebf\u89c2\u770b \u5e94\u6709\u5c3d\u6709</div></div><div class="app-banner-right"><a class="app-open-btn">\u7528\u5ba2\u6237\u7aef\u6253\u5f00</a><a class="app-dl-btn">\u7acb\u5373\u4e0b\u8f7d</a></div></div></div>'),$(".app-banner .app-open-btn").bindApplink({aid:g}),getDownloadUrl($(".app-banner .app-dl-btn")))})}}function bindRIAttent(){$(".r-info > .f").click(function(){attentionTrigger(!0)})}function bindRIUnattent(){var b=$(".r-info > .f");b.hover(function(){b.text("\u53d6\u6d88\u5173\u6ce8").addClass("hover")},function(){b.text("\u5df2\u5173\u6ce8").removeClass("hover")});b.click(function(){$(this);attentionTrigger(!1)})}function attentionTrigger(e){var d=$(".r-info > .f"),f=$(".r-info > .elec");e?attentionUser(d,parseInt(d.attr("mid")),function(b){d.animate({opacity:0},{duration:300,complete:function(){d.text("\u5df2\u5173\u6ce8").css({border:"1px solid #e5e9ef",backgroundColor:"#fff",color:"#99a2aa"}).hover(function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})},function(){$(this).css({backgroundColor:"#fff",border:"1px solid #e5e9ef"})});d.animate({opacity:1},{duration:300,complete:function(){d.delay(300).animate({width:"68px"},{duration:300});f.delay(300).animate({width:"138px"},{duration:300,complete:function(){f.text("\u4e3aTA\u5145\u7535").addClass("animate")}})}});bindRIUnattent()}}).off("click")}):unattentionUser(d,parseInt(d.attr("mid")),function(b){d.animate({opacity:0},{duration:300,complete:function(){d.text("\u5173\u6ce8").css({backgroundColor:"#00a1d6",border:"1px solid #00a1d6",color:"#fff"}).hover(function(){$(this).css({backgroundColor:"#00b5e5",border:"1px solid #00b5e5"})},function(){$(this).css({backgroundColor:"#00a1d6",border:"1px solid #00a1d6"})});d.animate({opacity:1},{duration:300,complete:function(){d.delay(300).animate({width:"138px"},{duration:300,complete:function(){d.removeClass("animate on hover")}});f.delay(300).animate({width:"68px"},{duration:300,complete:function(){f.text("\u5145\u7535").removeClass("animate on hover")}})}});bindRIAttent()}}).off("click").off("hover")})}function getAuthorInfo(){var f,e=parseInt(window.mid),h,g=!1;0<=$.inArray(e,window.AttentionList)&&(g=!0);$(".upinfo").length?(f=$(".upinfo"),h=$(".name",f).text(),f=$(".u-face img",f).attr("src")):($upinfo=$(".zu_play_info"),h=$(".upload_user a",f).attr("card"),f=$(".upload_user img",f).attr("src"));return{mid:e,uname:h,face:f,attention:g}}var loader=new LazyJSONLoader,bbBangumiSp=function(j,h,o,n,m,k){var l=this;this.$container=$(".v_bgm_list");this._aId=parseInt(j);this._page=parseInt(m);this._spId=parseInt(h);this._seasonId=parseInt(o);this._rawcode=n;this._apiBase="http://app.bilibili.com/bangumi";this._dataCache={};this._isbangumi=parseInt(k);1===this._isbangumi?(this.loadBangumi(j),window.seasonJsonCallback=function(e){$(".v_bgm_list").show();if(0==e.code){l._seasonId=e.result.season_id;l._seasonData=e.result.seasons;var d=l.sortEp(e.result.episodes);l._dataCache[l._apiBase+"/seasoninfo/"+e.result.season_id+".ver"]=d;l.$container.find(".bangumi-head a").text(e.result.title).attr("href","http://bangumi.bilibili.com/anime/"+e.result.season_id+"/");l.$container.attr("data-seasonid",e.result.season_id);l.$container.find("#subscribe_num").text(formatFriendlyNumber(e.result.favorites));if(e.result.evaluate){var f=$("#bangumi_info");f.find(".info-content[type=description] .info-content-inner").text(e.result.evaluate).css("white-space","pre-wrap");f.find(".info-content[type=staff] .info-content-inner").text(e.result.staff).css("white-space","pre-wrap");f.find(".info-content[type=cv] .info-content-inner").html(function(){for(var a="",p=0;p<e.result.actor.length;p++){var g=e.result.actor[p],a=a+('<div class="cv-item">'+g.role+"\uff1a"+g.actor+"</div>")}return a})}e.result.cover&&(l.$container.find(".preview").wrapInner('<a target="_blank" href="http://bangumi.bilibili.com/anime/'+e.result.season_id+'/"></a>'),l.$container.find(".preview img").attr("src",e.result.cover));l.parseEpisodeData(d);l.drawSeason();UserStatus.onLoaded(function(b){b.isLogin&&$.get("/api_proxy?app=bangumi&action=user_season_status&season_id="+l._seasonId,function(c){0==c.code&&showSpAdbtn(c.result.attention,null,l._seasonId)})})}}):o?this.loadSeason(h):this.loadEpisode2();$("#v_bgm_list_toggle").click(function(){l.toggleList()})};bbBangumiSp.prototype={_rawcode:null,_seasonData:null,_episodeData:null,_aId:null,_page:null,_spId:null,_seasonId:null,_totalPage:0,_maxPerPage:20,_pageLimit:20,_progressReported:!1,ajaxJsonp:function(g,f,k,j){var h=this;$.ajax({url:g,data:f,dataType:"jsonp",jsonp:"callback",jsonpCallback:k,error:j}).complete(function(){h._loading=!1})},loadBangumi:function(b){this.ajaxJsonp(this._apiBase+"/avseason/"+b+".ver",{},"seasonJsonCallback")},sortEp:function(e){var d=[],f;for(f=e.length-1;0<=f;f--){d.push(e[f])}return d},loadEpisode:function(e){if(1!==this._isbangumi){return this.loadEpisode2(e)}var d=this,f=this._apiBase+"/seasoninfo/"+e+".ver";this._dataCache[f]?this.parseEpisodeData(this._dataCache[f]):(window.episodeJsonCallback=function(b){0==b.code&&(b=d.sortEp(b.result.episodes),d._dataCache[f]=b,d.parseEpisodeData(b))},this._loading=!0,this.ajaxJsonp(f,{},"episodeJsonCallback"))},parseEpisodeData:function(b){$(".v_bgm_list").show();$("#v_bgm_list_page").hide().html("");$("#v_bgm_list_data").removeClass("on");$("#v_bgm_list_toggle .autoheight").removeClass("active");this._episodeData=b;this.drawFull(this.getPageByAid())},loadSeason:function(d){var c=this;loader.getJSON("/index/bangumi/"+d+"-sl.json",function(b){b&&(c._seasonData=b,c.drawSeason(),c.loadEpisode2(c._seasonId))})},loadEpisode2:function(d){var c=this;loader.getJSON(d?"/index/bangumi/"+this._spId+"-s"+d+".json":"/index/bangumi/"+this._spId+"-s0.json",function(b){$(".v_bgm_list").show();$("#v_bgm_list_page").hide().html("");$("#v_bgm_list_data").removeClass("on");$("#v_bgm_list_toggle .autoheight").removeClass("active");c._episodeData=c._normalize(b);c.drawFull(c.getPageByAid())})},toggleList:function(){var b=$("#v_bgm_list_data");b.hasClass("on")?(this.drawPart(),b.removeClass("on"),$("#v_bgm_list_page").hide(),$("#v_bgm_list_toggle .autoheight").removeClass("active")):(this.drawFull(this.getPageByAid()),b.addClass("on"),$("#v_bgm_list_toggle .autoheight").addClass("active"))},getPageByAid:function(){var b=0;this._episodeData.length>this._maxPerPage&&(b=parseInt(this.episodeByAid(this._aId,this._page)/this._maxPerPage));return b},drawSeason:function(h){this._seasonId=h=h||this._seasonId;var f,m=Math.ceil(2.5),l,k=$("#v_bgm_list_tab");$("#v_bgm_list_tab").html("");l=this.seasonByAid(h);if((h=this._seasonData.length)&&1!=h){f=5>=h?0:Math.max(0,l-m);m=5>=h?h-1:Math.min(l+m,h-1);for(5<h&&(0==f?m=4:m==h-1&&(f=h-5));f<=m;f++){if(l=this._seasonData[f]){l=this.createSeasonItem(k,l),k.append(l)}}if(5<h){var k=$('<li class="bgm-list-btn"><i class="b-icon b-icon-arrow-d"></i></li>').appendTo(k),j=$('<ul class="bgm-list-panel"></li>').hide().appendTo(k);k.hover(function(){j.stop(!0,!0).slideDown(200)},function(){j.stop(!0,!0).slideUp(200)});for(f=0;f<h;f++){if(l=this._seasonData[f]){l=this.createSeasonItem(j,l,function(){j.stop(!0,!0).slideUp(200)}),j.append(l)}}}}},drawPart:function(){var f=0,e=$("#v_bgm_list_toggle"),h=$("#v_bgm_list_data");h.html("");f=this.episodeByAid(this._aId,this.page);this._episodeData.length<this._pageLimit?e.hide():e.show();-1==f&&(f=this._episodeData.length-1);var e=this._episodeData.length,g=this._pageLimit;lowerLimit=upperLimit=Math.min(f,e);for(f=0;f<g&&f<e;){0<lowerLimit&&(lowerLimit--,f++),f<g&&upperLimit<e&&(upperLimit++,f++)}for(f=lowerLimit;f<upperLimit;f++){if(e=this._episodeData[f]){if(-1==e.episode||"-1"==e.episode){e.episode="\u5168\u96c6"}h.append(this.createEpItem(f,e))}}},drawFull:function(e){var d=0,f=0;if(!e||0>e){e=0}$("#v_bgm_list_data").html("");this._episodeData.length>this._maxPerPage&&($("#v_bgm_list_page").show(),this._totalPage=Math.ceil(this._episodeData.length/this._maxPerPage),this.drawPagination(e));f=e*this._maxPerPage;if(e<=this._episodeData.length&&0<=f){for(e=f;e<this._episodeData.length;e++){if(d<this._maxPerPage&&(d++,f=this._episodeData[e],"object"===typeof f)){if(-1==f.episode||"-1"==f.episode){f.episode="\u5168\u96c6"}$("#v_bgm_list_data").append(this.createEpItem(e,f))}}}},createSeasonItem:function(f,e,h){var g=this;1!==this._isbangumi&&(e.title=e.season_name);f=$("<li data-id='"+e.season_id+"'>"+e.title+"</li>");f.click(function(){g._loading||($("#v_bgm_list_tab").find("li").removeClass("on"),$("#v_bgm_list_tab").find('li[data-id="'+$(this).attr("data-id")+'"]').addClass("on"),g.loadEpisode($(this).attr("data-id")),g.drawSeason($(this).attr("data-id")),"function"==typeof h&&h())});this._seasonId==e.season_id&&f.addClass("on");return f},createEpItem:function(f,e){var h=this;if(1!==this._isbangumi){return this.createEpItem2(f,e)}var g=$('<a data-id="'+e.episode_id+'" idx="'+f+'" href="/video/av'+e.av_id+"/"+(1<parseInt(e.page)?"index_"+e.page+".html":"")+'">'+e.index+"</a>");if(!(e.av_id!=this._aId||parseInt(e.page)&&parseInt(e.page)!=this._page||(g.addClass("active"),this._progressReported))){UserStatus.onLoaded(function(b){b.isLogin&&$.get("/api_proxy?app=bangumi&action=/report_watch",{episode_id:g.attr("data-id")},function(c){h._progressReported=!0})})}return g},createEpItem2:function(e,d){var f=$('<a idx="'+e+'" href="/video/av'+d.aid+"/"+(1<d.page?"index_"+d.page+".html":"")+'">'+d.episode+"</a>");d.aid==this._aId&&d.page==this._page&&f.addClass("active");return f},drawPagination:function(h){var f=this,m=this._totalPage-1,l=0,k=0;$("#v_bgm_list_page").html("");for(var j=0;j<=m;j++){j==m?l=$("<a page='"+j+"'>\u7b2c"+this.episodeByIndex(j*this._maxPerPage).val.index+"-"+this.lastEpisode().index+"\u96c6</a>"):(l=this.episodeByIndex(j*this._maxPerPage).val.index,k=this.episodeByIndex(j*this._maxPerPage+(this._maxPerPage-1)).val.index,l=$("<a page='"+j+"'>\u7b2c"+l+"-"+k+"\u96c6</a>")),h==j&&l.addClass("active"),l.click(function(){f.drawFull($(this).attr("page"))}),$("#v_bgm_list_page").append(l)}},seasonByAid:function(e){var d=0,f;for(f in this._seasonData){if(this._seasonData[f].season_id==e){return d}d++}return -1},episodeByAid:function(f,e){var h=0,g;for(g in this._episodeData){if(this._episodeData[g].av_id==f&&(parseInt(1==this._episodeData[g].page)||parseInt(this._episodeData[g].page)==e)){return h}h++}return -1},episodeByIndex:function(e){var d=0,f;for(f in this._episodeData){if(d==e){if(-1==this._episodeData[f].index||"-1"==this._episodeData[f].index){this._episodeData[f].index="\u5168\u96c6"}return{key:f,val:this._episodeData[f]}}d++}return null},lastEpisode:function(){return this._episodeData[this._episodeData.length-1]},_normalize:function(e){for(var d=0;d<e.length;d++){var f=e[d];f.index=f.episode;f.av_id=f.aid;f.page=0==f.page?1:f.page}return e}};function tracksendLog(d,c){$('<script type="text/javascript" src="https://secure.bilibili.com/tracklog?url='+encodeURIComponent(d)+"&tp="+encodeURIComponent(c)+"&refer="+encodeURIComponent(document.referrer)+'">\x3c/script>').appendTo("body")}var trackTime,adCheckInt=null,isCProTrackSent=!1;function trackCProLog(){tracksendLog(document.location,"b");isCProTrackSent=!0}function trackCProTimeOver(){trackTime=new Date;clearTimeout(adCheckInt);isCProTrackSent||(adCheckInt=setTimeout(function(){clearTimeout(adCheckInt);trackCProLog()},3000))}var _ads_bindCount=0;function bindAdElement(){for(var d=document.getElementsByTagName("iframe"),c=0;c<d.length;c++){-1<d[c].src.indexOf("www.bilibili.com/bd")&&__GetCookie("DedeUserID")&&(d[c].onmousedown=trackCProLog,d[c].onmouseover=trackCProTimeOver,d[c].onactivate=trackCProLog,d[c].onclick=trackCProLog,d[c].onfocusin=d[c].onfocus=trackCProLog,d[c].contentWindow.onactivate=d[c].contentWindow.onfocusin=d[c].contentWindow.onfocus=trackCProLog,_ads_bindCount++)}d=document.getElementsByTagName("div");for(c=0;c<d.length;c++){if("comm_content"==d[c].id||"viewbox"==d[c].className||"upinfo"==d[c].className||"ad-f"==d[c].className||"bottom"==d[c].className||"tagcontainer"==d[c].className||"scontent"==d[c].className){d[c].onmouseover=function(){null==adCheckInt||50>(new Date).getTime()-trackTime.getTime()||(clearTimeout(adCheckInt),adCheckInt=null)}}}$("body").mouseover(function(){null==adCheckInt||50>(new Date).getTime()-trackTime.getTime()||(clearTimeout(adCheckInt),adCheckInt=null)})}function getBasicHighCharts(d,c){d.chart.renderTo=c;d.subtitle={text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Drag your finger over the plot to zoom in"};return d}function goQuote(){var d=$(".quote"),c=d.offset();$("html,body").animate({scrollTop:c.top-80},300);d.delay(300);for(i=0;3>i;i++){d.animate({borderColor:"#00a1d6"},250),d.animate({borderColor:"#efefef"},250)}}function miniPlayer(){var s=$("#bofqi");if((0<s.find("iframe").length||0<s.find("embed").length&&0<=s.find("embed").attr("src").indexOf("play.swf")||0<s.find("#player_placeholder").length)&&0==$("#sponsor_list").length&&$(".v_small").length){var r=s.offset().top+s.height()+100,q=0,p=!1;$('<input type="checkbox" id="checkbox_miniplayer" /><label class="no-select" for="checkbox_miniplayer">\u5f00\u542f\u8ff7\u4f60\u64ad\u653e\u5668</label>').appendTo(".common .b-head");var o=$("#checkbox_miniplayer"),m=null;1!=ChatGetSettings("b_miniplayer")&&null!=ChatGetSettings("b_miniplayer")||o.attr("checked",!0);o.change(function(){var a=$(this).is(":checked")?1:0;ChatSaveSettings("b_miniplayer",a);0==a?(p=!0,l()):(r==s.offset().top+s.height()+100||s.hasClass("float")||(r=s.offset().top+s.height()+100),$(window).scrollTop()>r&&(p=!1,n()))});var n=function(){if(!s.hasClass("float")&&!p&&0!=$(".comm").find("ul").length){var a=$('<div class="b-player-dummy"></div>').insertBefore(s);s.hasClass("wide")&&a.addClass("wide");$('<div class="move"><div class="gotop">\u56de\u5230\u9876\u90e8</div><div class="t">\u70b9\u51fb\u6309\u4f4f\u62d6\u52a8</div><div class="close">\u5173\u95ed</div></div>').prependTo(s);0<$(".huodong_bg").length&&$(".huodong_bg").hide();s.addClass("float").stop().animate({opacity:1},300);m?s.css(m):(a=0<$(".rat").length?$(".rat").offset().left:$(".v_small").offset().left,s.css({left:a,opacity:0}),730>=$(window).height()&&s.css({top:"inherit",bottom:"5px"}))}},l=function(){j();$(".move",s).remove();$(".b-player-dummy").remove();s.removeClass("float");s.css({left:"",top:"",bottom:""});0<$(".huodong_bg").length&&$(".huodong_bg").show()},j=function(){q=0;$(".mmask").remove();$(document).unbind("mousemove");$("body,#bofqi").removeClass("noselect");$(".move",s).removeClass("on")};$(document).on("scroll.miniplayer",function(){0!=ChatGetSettings("b_miniplayer")&&(r==s.offset().top+s.height()+100||s.hasClass("float")||(r=s.offset().top+s.height()+100),$(window).scrollTop()>r?n():(p&&(p=!1),s.hasClass("float")&&l()))});s.hover(function(){s.hasClass("float")&&!q&&$(".move",s).show()},function(){q||$(".move",s).hide()});$(s).delegate(".move","mousedown",function(a){q=1;$("body,#bofqi").addClass("noselect");$(this).addClass("on");$('<div class="mmask"></div>').appendTo("body");var f=a.pageX-$(this).offset().left,c=a.pageY-$(this).offset().top;$(document).bind("mousemove",function(d){var g=d.clientX-f,e=d.clientY-c<=$(window).height()-s.height()?d.clientY-c:$(window).height()-s.height(),e=d.clientY-c>=$(window).height()-s.height()-5?$(window).height()-s.height()-5:0>=d.clientY-c?0:d.clientY-c;m={left:g,top:e};s.css(m)})});$(s).delegate(".move","mouseup",function(b){j()});$(s).delegate(".move .close","click",function(b){p=!0;l()});$(s).delegate(".move .gotop","click",function(b){$("html,body").animate({scrollTop:$(".viewbox").offset().top},300)})}}function rateFrm(h){function f(d){var c=$(this).find(">span");$(this).find(".t-right-bottom");UserStatus.isLogin(c)&&(1>UserStatus.level()?(new MessageBox(m)).show(c,"\u7b49\u7ea7\u4e0d\u8db3LV1\uff0c\u65e0\u6cd5\u6295\u786c\u5e01",1500):d?l.show({bound:!1,Overlap:!0,backdrop:!0,animation:!1,zIndex:100001}).css({position:"fixed",top:"50%",left:"50%",marginTop:-150,marginLeft:-176}):l.show())}var m={focusShowPos:"down"};$(".block.coin").show();var l=new sendCoin($(".block.coin"),$(".block.coin").find(".t-right-bottom"),h);$(".block.coin").click(function(){f()});GNS.playerCallSendCoin=function(){f(!0)};window.playerCallSendCoin=function(){f(!0)};h=$(".v-title-line.coin_btn");var k=h.find("i.b-icon"),j=new Animator({element:k,frameSource:"http://static.hdslb.com/images/base/anim-coin-small.png",frameWidth:60,frameHeight:60,fps:24,totalFrame:19});h.on("mouseenter.anim",function(){j.start(1)}).on("mouseleave.anim",function(){j.back()}).click(function(){f(!0)})}var sendCoin=function(e,d,f){this.$container=e;this.target=d;this.requestCache=!1};sendCoin.prototype={options:{},show:function(e){var d=this,f=$.extend({focusShowPos:"down"},e||{});d.options=e||{};d.coinBox=new MessageBox(f);e=d.coinBox.show(d.$container,'<div class="coin-panel">\u52a0\u8f7d\u4e2d...</div>',0,"button",function(){return d._send()});d.coinBox.msgbox&&(d.msgbox=d.coinBox.msgbox.addClass("m-coin"),"object"==typeof d.requestCache?d._bindStatus(d.requestCache.number):$.ajax({url:"//www.bilibili.com/plus/account/exp.php",type:"get",dataType:"json",success:function(b){b&&0==b.code?(d.requestCache={number:b.number},d._bindStatus(b.number)):d._bindStatus(50)},error:function(){d._bindStatus(50)}}));return e},_bindStatus:function(k){if(!this.msgbox||!this.msgbox.find(".coin-panel").length){return !1}var j=this;j.info=window.biliLoginStatus;var q=j.$container.attr("arctype"),p=j.info.level_info.current_level;j.btn=j.msgbox.find(".b-btn.ok");j.coin_num="Original"==q?2:1;var o=j.msgbox.find(".coin-panel").empty(),m=$('<div class="coin-nav"></div>').appendTo(o),n=$('<div class="coin-main"></div>').appendTo(o),l=0;"Original"==q&&m.addClass("coin-nav-less");for(o=0;o<j.coin_num;o++){(function(b){var a=$('<span class="coin-nav-single">'+(b+1)+'<span class="coin-nav-text">\u679a</span></span>').data("num",b+1).appendTo(m);j.info.money<=b&&a.addClass("disabled").data("errtype","money");1==b?"Original"!=q&&3>p?a.addClass("disabled").data("errtype","3"):a.hasClass("disabled")||(l=b):2==b?"Original"!=q&&5>p?a.addClass("disabled").data("errtype","5"):"Original"==q&&3>p?a.addClass("disabled").data("errtype","3"):a.hasClass("disabled")||(l=b):3<=b?"Original"==q&&p<=b?a.addClass("disabled").data("errtype",b+1):a.hasClass("disabled")||(l=b):a.hasClass("disabled")||(l=b);a.click(function(){$(this).siblings().removeClass("active");$(this).addClass("active");n.empty();if($(this).hasClass("disabled")){if(j.msgbox.find(".b-btn.ok").addClass("disabled"),"money"==$(this).data("errtype")){n.addClass("coin-error").html('<div class="coin-main-title">\u60a8\u7684\u5269\u4f59\u786c\u5e01\u4e0d\u8db3\u54e6</div><div class="coin-main-sub"><i class="b-icon icon-coin-round"></i>\u4f59\u989d'+j.info.money+'\uff0c<a href="http://www.bilibili.com/html/help.html#m_2" target="_blank">\u5982\u4f55\u83b7\u5f97\u786c\u5e01\uff1f</a></div>')}else{if($(this).data("errtype")){var d=parseInt($(this).data("errtype"))||0;n.addClass("coin-error").html('<div class="coin-main-title">\u5347\u5230Lv'+d+'\u5c31\u53ef\u4ee5\u6295\u4e86\u54e6</div><div class="coin-main-sub"><a href="http://www.bilibili.com/html/help.html#k" target="_blank">\u4f1a\u5458\u7b49\u7ea7\u76f8\u5173\u8bf4\u660e ></a></div>')}}}else{j.msgbox.find(".b-btn.ok").removeClass("disabled"),j.btn.data("num",$(this).data("num")),d=10*parseInt($(this).data("num"))||0,n.removeClass("coin-error").html('<div class="coin-main-title">\u6295\u5e01\u652f\u6301\uff0c\u5c06\u6d88\u8017\u60a8<span class="coin-main-number">'+$(this).data("num")+"</span>\u786c\u5e01</div>"+(50>k?'<div class="coin-main-sub"><i class="b-icon icon-exp-round"></i>\u7ecf\u9a8c\u503c+'+(50<d+k?50-k:d)+"\uff08\u4eca\u65e5"+k+"/50\uff09</div>":""))}})})(o)}m.children().eq(l).click()},_send:function(){var e=this,d=parseInt(e.btn.data("num"))||0,f={zIndex:null,focusShowPos:"down"};e.options.zIndex&&(f.zIndex=e.options.zIndex+1);if(e.btn.hasClass("disabled")){return !1}e.btn.addClass("disabled");$.ajax({url:"/plus/comment.php",type:"post",data:{aid:aid,rating:100,player:1,multiply:d},success:function(u){e.btn.removeClass("disabled");e.requestCache=!1;if("OK"==u){u=0;for(var t=(window.AttentionList||[]).length;u<t;u++){if(AttentionList[u]==mid){(new MessageBox(f)).show(e.target,"\u6295\u5e01\u6210\u529f",1500);_rateComplete(e.target,d);e.coinBox.close();var r;$(".arc-toolbar .elecrank-btn").trigger("mouseenter").on("mouseenter.clearElec",function(){clearTimeout(r);$(this).off("mouseenter.clearElec")});r=setTimeout(function(){$(".arc-toolbar .elecrank-btn").trigger("mouseleave")},5000);return}}e.coinBox.close();var s=$('<div class="m-layer" style="width: 340px; height: 120px; text-align: center;"><div style="padding: 30px 0 15px 0; height: 20px; line-height: 20px; font-size: 16px;">\u6295\u5e01\u6210\u529f</div><div><a class="attention-btn" style="display: inline-block; width: 48px; height: 24px; line-height: 24px; margin-right: 5px; background: #00a1d6; color: #fff; border-radius: 4px;">\u5173\u6ce8</a>UP\u4e3b, \u53ca\u65f6\u4e86\u89e3TA\u7684\u6700\u65b0\u4f5c\u54c1~</div><div style="position: absolute; height: 28px; line-height: 28px; width: 70px; right: 10px; top: 10px; background: #6f6f6f; color: #fff; cursor: pointer; border-radius: 4px; font-size: 12px;" class="close-btn">\u5173\u95ed <span>( </span><span class="attention-count">6</span><span> )</span></div></div>');u=$(".block.coin").offset();var p=6,o;e.options.backdrop?s.css({position:"fixed",top:"50%",left:"50%",marginLeft:-170,marginTop:-60,zIndex:e.options.zIndex||20000}):s.css({left:u.left-290+"px",top:u.top});$("body").append(s);var j=s.find(".attention-btn"),a=s.find(".close-btn"),b=s.find(".attention-count");j.on("click.attention",function(){$(".r-info > .f").trigger("click");s.remove()});j.hover(function(){$(this).css("background-color","#00b5e5")},function(){$(this).css("background-color","#00a1d6")});var c=function(){p--;0===p?(clearTimeout(o),j.off(),s.remove()):(b.text(p),o=setTimeout(c,1000))};o=setTimeout(c,1000);a.hover(function(){$(this).css("background-color","#888")},function(){$(this).css("background-color","#6f6f6f")});a.on("click",function(){clearTimeout(o);j.off();a.off();s.remove()})}else{(new MessageBox(f)).show(e.btn,u,1500)}(new Animator({element:$(".v-title-line.coin_btn").find("i.b-icon"),frameSource:"http://static.hdslb.com/images/base/anim-coin-small.png",frameWidth:60,frameHeight:60,offsetY:60,fps:24,totalFrame:40})).start()},error:function(){e.btn.removeClass("disabled");(new MessageBox(f)).show(e.btn,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5",1500)}});return !1}};function _rateComplete(f,e){e=e||1;var h=$('<div class="plus-num">+'+e+"</div>"),g=parseInt(f.html())||0;f.html(g+e);h.appendTo(f).animate({bottom:"70px"},300,function(){h.fadeOut(100,function(){h.remove()})})}function OnBpRankList(b){onLoginInfoLoaded(function(a){createBpRankList(b)})}$(document).ready(function(){$("#sponsor_list").length&&OnBpRankList()});function createBpRankList(s){function r(h,f){var v,u=!1;0!=h.uid?v=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+f+'</div><a href="http://space.bilibili.com/'+h.uid+'" card="'+h.uname+'" target="_blank"><div class="face"><img src="'+utils.thumbnail(h.face,36)+'" /></div></a></div></li>'):(u=!0,v=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+f+'</div><div class="face"><img src="'+h.face+'" /></div></div></li>'));var t=$('<div class="detail"></div>').appendTo(v.find(".rank-item")),k=$('<div class="name">'+h.uname+"</div>");u||(k=$('<a href="http://space.bilibili.com/'+h.uid+'" card="'+h.uname+'" target="_blank"></a>').append(k));k.prependTo(t);3>=f&&(v.addClass("top n"+f),v.find(".rank-num").addClass("n"+f),h.message?t.append('<div class="msg">'+h.message+"</div>"):t.append('<div class="msg">TA\u6ca1\u6709\u7559\u8a00</div>'),t.find(".msg").append('<div class="arrow"></div>'));return v}function q(c,g){if(c){o.empty();for(var h=!1,b=0;b<c.length;b++){var f=c[b],e=r(f,f.rank).appendTo(o);f.uid==window.uid&&(e.addClass("mine"),h=!0)}g.mine&&!h&&(e=r({uid:window.uid,uname:window.biliLoginStatus.uname,face:window.biliLoginStatus.face},g.mine.rank).addClass("mine").appendTo(o));j.empty();pagelist(j,l+1,n,g.list.list.length,function(d){l=d-1;q(m[l],g)},"",2);j.find(".result,.indexPage,.endPage").remove();bindCardEvent(o)}}var p=$("#sponsor_list"),o=p.find("ul"),m=[],n=0,l=0,j=$('<div class="pagelistbox small"></div>');$.getJSON("/widget/ajaxGetBP?aid="+window.aid,function(h){l=0;var g=$(".bangumi-buybuybuy"),e=h.users||0;g.find(".total b").html(e);if(h.list&&0==h.list.code){var f=h.list.list;n=Math.ceil(f.length/10);for(var d=f.length,c=0;c<n;c++){for(var w=[],k=10*(c+1)>d?d:10*(c+1),v=10*c;v<k;v++){w.push(f[v])}m.push(w)}10<h.list.list.length&&(p.find(".pagelistbox").length?j=p.find(".pagelistbox"):j.insertAfter(o));q(m[l],h)}h.mine&&(g.addClass("done"),f=window.biliLoginStatus.face,null!=f.match("_s")&&f.replace("_s","_m"),g.find(".b-btn.buy").addClass("done").html("\u6211\u627f\u5305\u4e86\u8fd9\u96c6<b>"+h.mine.count+"</b>B\u5e01"));p.find(".list-total .total").html(e+"<div>\u627f\u5305\u5546\u4eba\u6570</div>");0==h.list.list.length&&o.append('<li class="no-sponsor">\u6682\u65f6\u6ca1\u6709\u627f\u5305\u5546( >\ufe4f<\u3002)\uff5e</li>');h=h.percent;animateCss=60<=h?"animate green":40<=h?"animate yellow":20<=h?"animate orange":"animate red"}).error(function(){o.append('<li class="no-sponsor">\u52a0\u8f7d\u5931\u8d25</li>')})}function createBatteryRankList(s,r){function q(h){j.empty();for(var f=0;f<h.length;f++){var v=h[f],u=v.rank,t=void 0,k="";v.is_anonymity?(k="\u533f\u540d\u7528\u6237",t=$('<li class="clearfix"><div class="rank-item"><div class="rank-num">'+u+'</div><div class="face"><img src="http://static.hdslb.com/images/hidden.png" /></div></div></li>')):(k=v.name,t=$('<li mid="'+v.mid+'" class="clearfix"><div class="rank-item"><div class="rank-num">'+u+'</div><a href="http://space.bilibili.com/'+v.mid+'" card="'+k+'" target="_blank"><div class="face"><img src="'+v.face+'" /></div></a></div></li>'));$('<div class="name">'+k+"</div>").insertAfter(t.find(".face"));3>=u&&t.find(".rank-num").addClass("n n"+u).html("");t.attr("rank",u);u=t.appendTo(j);v.mid==window.uid&&u.addClass("mine").find(".rank-num").html("\u6211")}bindCardEvent(j)}function p(e){var c,k;if(e.code){j.append('<li class="no-data">\u52a0\u8f7d\u5931\u8d25</li>'),m.removeClass("loading").append('<div class="error">\u52a0\u8f7d\u5931\u8d25</div>')}else{if(e.rankList&&e.rankList.result){c=e.rankList.result;for(var g=0;g<c.length;g++){c[g].mid==window.uid&&(c[g].face=c[g].face||biliLoginStatus.face,c[g].name=c[g].name||biliLoginStatus.uname)}k=e.rankList.total_feed_user;q(c)}else{c=[],k=0,j.append('<li class="no-data">\u6682\u65f6\u6ca1\u6709\u4eba\u5145\u7535( >\ufe4f<\u3002)\uff5e</li>')}0==k?l.find(".hd-txt").html("UP\u4e3b\u80fd\u91cf\u4e0d\u8db3"):l.find(".hd-txt").html('\u5171 <b class="total-num">'+k+"</b> \u4eba\u63d0\u4f9b\u4e86\u80fd\u91cf");var h=setInterval(function(){if("undefined"!=typeof EnergyPool){clearInterval(h);m.removeClass("loading").empty();var b="undefined"!=typeof document.createElement("canvas").getContext("2d")?"canvas":"div";(new EnergyPool("#energy_pool_container",{uid:window.uid,mode:b,width:270,height:118,data:c,total:k,create:function(d){o.find(".pipe").css("background-color",d.colorLevel.pool);l.css("background-color",d.colorLevel.pool);l.find("#rank_btn_feed").addClass(d.colorLevel.level).css("background-color",d.colorLevel.btn)}})).init()}},100)}}var o=$(".energy-pool"),m=null;0==o.length?(o=$('<div class="energy-pool"><div class="pool-hd"><div class="up-face"><a href="http://space.bilibili.com/'+r.uid+'" target="_blank"><img src="'+r.face+'" /></a></div><span class="t">'+r.nick+'\u7684\u80fd\u91cf\u6c60</span></div><div id="energy_pool_container"></div><div class="pipe"></div></div>').appendTo(".v_small"),$('<script type="text/javascript" src="http://static.hdslb.com/battery/js/energy.js">\x3c/script>').appendTo("head"),m=$("#energy_pool_container").addClass("loading")):m=$("#energy_pool_container").addClass("loading").empty();var n=$("#battery_ranking").empty();0==n.length&&(n=$("<div>").addClass("battery-ranking").attr("id","battery_ranking").appendTo(".v_small"));var l=$('<div class="list-head"><span class="hd-ico"></span><span class="hd-txt"></span><div id="rank_btn_feed" class="bangumi-btn">\u6211\u6765\u63d0\u4f9b\u80fd\u91cf</div></div>').appendTo(n),n=$("<div>").addClass("list-wrp clearfix").appendTo(n),j=$("<ul>").appendTo(n);"object"!=typeof s?$.ajax({url:"http://prop.bilibili.com/api/electric/query.rank.list",data:{mid:window.uid,aid:r.aid,top:10,captcha:window.captcha_key},dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(b){p(b);b.code||(window.fb=new bbFeedbackPlugIn(".bp_comment",b,r),fb.show(r.aid,1))},error:function(){j.append('<li class="no-data">\u52a0\u8f7d\u5931\u8d25</li>');m.removeClass("loading").append('<div class="error">\u52a0\u8f7d\u5931\u8d25</div>')}}):p(s)}function initToolBar(){if(0!=$(".arc-toolbar, .arc-tool-bar").length){for(var k=$("#app_qrcode_box"),j={},q=[{name:"share",totalFrame:17},{name:"fav",totalFrame:14,loopFrame:1},{name:"app",totalFrame:16,loopFrame:10},{name:"zan",totalFrame:7,loopFrame:1},{name:"coin",totalFrame:7,loopFrame:1}],p=$(".arc-toolbar"),o=0;o<q.length;o++){(function(b){var h=$("."+b.name,p),f=$(".b-icon-anim-"+b.name,h),d="undefined"!=typeof b.loopFrame?b.loopFrame:void 0;j[b.name]=new Animator({element:f,frameSource:"http://static.hdslb.com/images/base/anim-"+b.name+".png",frameWidth:80,frameHeight:80,fps:10,totalFrame:b.totalFrame});h.mouseenter(function(){if(!f.length){return !1}if(f.hasClass("on")){return j[b.name].stop(),f.css("background-position","0px -80px"),!1}j[b.name].start(d)}).mouseleave(function(){j[b.name].back()})})(q[o])}var m=k.find(".qr-code-box"),n=null;0<m.length&&(q=$("#qr_code"),o={width:100,height:100,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href},"undefined"!=typeof document.createElement("canvas").getContext?o.render="canvas":o.render="table",q.empty().qrcode(o).data("qrcode",o),k.addClass("initialized").hover(function(){clearTimeout(n);n=setTimeout(function(){m.stop(!0,!0).slideDown(200)},300)},function(){clearTimeout(n);m.stop(!0,!0).slideUp(200)}));var k=$(".block.share").addClass("initialized"),l=$(".share-box",k);k.hover(function(){clearTimeout(n);n=setTimeout(function(){l.stop(!0,!0).slideDown(200,function(){$(this).hasClass("copyinit")||($(this).addClass("copyinit"),$(".address-copy").each(function(d,c){$(c).click(function(){ShareModule.addShare()});$(c).zclip({path:"http://static.hdslb.com/swf/ZeroClipboard.swf",copy:function(){return $(c).prev().val()},afterCopy:function(){(new MessageBox).show($(c),"\u5df2\u6210\u529f\u590d\u5236\u5230\u526a\u5207\u677f",1000)}});$(c).bind("mouseleave",function(b){b.stopPropagation()})}))})},300)},function(){clearTimeout(n);l.stop(!0,!0).slideUp(200)});onLoginInfoLoaded(function(b){rateFrm(b)});"undefined"!=typeof wb_url&&bindShare({url:wb_url,title:wb_info&&$(".v-title h1").text(),desc:"undefined"!=typeof wb_desc?wb_desc:"",summary:"undefined"!=typeof wb_summary?wb_summary:"",shortTitle:"undefined"!=typeof wb_title?wb_title:wb_info,weiboTag:"#\u54d4\u54e9\u54d4\u54e9\u52a8\u753b#"})}}var ShareModule={shared:!1,openShareWindow:function(f,e){var h=[],g;for(g in e){null!=e[g]&&h.push(g+"="+encodeURIComponent(e[g]))}h=f+h.join("&");window.open(h,"","width=760, height=640, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no");return !1},bind:function(g,f){var k=this;f=f||"#share_list .share-btn";g=$.extend(!0,{title:document.title,url:location.href,desc:"",pic:"",summary:"",shortTitle:"",searchPic:!1,appkey:{weibo:"2841902482",qqweibo:"84435a83a11c484881aba8548c6e7340"},weiboTag:"",twitterTag:"",aid:window.aid,tp_id:window.tp_id},g);$(f).click(function(a){var m=$(this),l=m.attr("id")||m.attr("data-id");if("btn_weixin"!=l){k.addShare(g)}else{if(!m.attr("id")){a.stopPropagation();var c=m.find(".share-weixin");c.length||(c=$('<div class="share-weixin"><div class="qr-code"></div><p>\u7528\u5fae\u4fe1\u626b\u4e00\u626b</p></div>').appendTo(m).hide(),a={width:100,height:100,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href},"undefined"!=typeof document.createElement("canvas").getContext?a.render="canvas":a.render="table",c.find(".qr-code").qrcode(a));c.is(":visible")?c.stop(!1,!0).slideUp(200):c.stop(!1,!0).slideDown(200);$("body").off("click.v-weixin-share");$("body").on("click.v-weixin-share",function(){c.stop(!1,!0).slideUp(200);$("body").off("click.v-weixin-share")})}}switch(l){case"btn_weibo":k.openShareWindow("http://service.weibo.com/share/share.php?",{url:g.url,type:"3",count:"1",appkey:g.appkey.weibo,title:g.title+g.weiboTag,pic:g.pic,searchPic:g.searchPic,ralateUid:"",language:"zh_cn",rnd:(new Date).valueOf()});break;case"btn_qqweibo":k.openShareWindow("http://v.t.qq.com/share/share.php?",{title:g.title,url:g.url,appkey:g.appkey.qqweibo,site:"http://www.bilibili.com/",assname:"bilibiliweb",pic:g.pic});break;case"btn_qqzone":k.openShareWindow("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",{url:g.url,showcount:1,desc:g.desc,summary:g.summary,title:g.shortTitle,site:"\u54d4\u54e9\u54d4\u54e9",pics:g.pic,style:"203",width:98,height:22});break;case"btn_baidu":k.openShareWindow("http://tieba.baidu.com/f/commit/share/openShareApi?",{title:g.title,url:g.url,uid:726865,to:"tieba",type:"text",relateUid:"",pic:g.pic,key:"",sign:"on",desc:"",comment:g.desc});break;case"btn_twitter":k.openShareWindow("https://twitter.com/intent/tweet?",{text:g.desc||g.title,hashtags:g.twitterTag,url:g.url});break;case"btn_facebook":k.openShareWindow("https://www.facebook.com/share.php?",{src:"",u:g.url});break;case"btn_qq":k.openShareWindow("http://connect.qq.com/widget/shareqq/index.html?",{url:g.url,desc:g.desc,title:g.title,summary:g.summary,pics:g.pic,flash:"",site:"",style:"201",width:32,height:32})}});var j=$('<div class="share-weixin"><div class="qr-code"></div></div>').appendTo($("#btn_weixin")),h={width:150,height:150,typeNumber:-1,correctLevel:0,background:"#fff",foreground:"#000",text:location.href};"undefined"!=typeof document.createElement("canvas").getContext?h.render="canvas":h.render="table";$.fn.qrcode?j.find(".qr-code").qrcode(h).data("qrcode",h):RequireModule.getScript("js/jquery.qrcode.min.js",function(){j.find(".qr-code").qrcode(h).data("qrcode",h)});$(".address-copy").click(function(){copy_clip($(this).prev().val());(new MessageBox).show($(this),"\u5df2\u6210\u529f\u590d\u5236\u5230\u526a\u5207\u677f")});return{getParams:function(a){return g[a]},setParams:function(a,d){g.hasOwnProperty(a)&&(g[a]=d)}}},app:{defaultParams:{type:"image",url:location.href,title:document.title,image_url:"",text:""},shareDataStr:null,set:function(b){b=$.extend(!0,this.defaultParams,b);b=JSON.stringify(b);window.biliios?window.biliios.setShareContext(b):window.biliandroid&&window.biliandroid.setShareContext?window.biliandroid.setShareContext(b):window.biliandroid&&window.biliandroid.setShareContent&&window.biliandroid.setShareContent(b);return this.shareDataStr=b},show:function(){window.biliios?window.biliios.showShareWindow(this.shareDataStr||JSON.stringify(this.defaultParams)):window.biliandroid&&window.biliandroid.showShareWindow(this.shareDataStr||JSON.stringify(this.defaultParams))}},addShare:function(e){var d=this;e=$.extend(!0,{aid:window.aid,tp_id:window.tp_id},e);if(!d.shared&&(e.aid||e.tp_id)){var f;if(e.aid){f=0,e=e.aid}else{if(e.tp_id){f=3,e=e.tp_id}else{return !1}}$.ajax({url:"//api.bilibili.com/x/share/add",type:"post",data:{type:f,id:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0},dataType:"json",success:function(b){if(b&&0==b.code){d.shared=!0;var k=$(".block.share").find(".t-right-bottom"),h=$('<div class="plus-num">+1</div>'),j=parseInt(k.html())>>0;j<b.data>>0&&(k.html(j+1),h.appendTo(k).animate({bottom:"70px"},300,function(){h.fadeOut(100,function(){h.remove()})}))}}})}}};window.bindShare=function(){return ShareModule.bind.apply(ShareModule,arguments)};function onPlayerScriptJump(e,d,f){e="http://www.bilibili.com/video/"+e;d&&1!=parseInt(d)&&(e+="#page="+d);f?window.open(e,"_blank"):location.href=e}var lazyImage=new LazyImage,RecommendArea=function(){function f(b,d){$.getJSON(d,function(a){b.find(".b-loading").remove();a&&0==a.code?a&&0==a.code&&((a=a.data)&&a.length?e(b,a):$(".recommend-area").remove()):$(".recommend-area").remove()})}function e(d,c){if(c){for(var m=0;m<c.length;m++){g(c[m]).appendTo(d)}d.width(c.length*d.children().outerWidth(!0));d.data("left",0);var l=$('<div class="page prev no-select"><span class="icon"></span></div>').insertAfter(d).hide().on("click",function(){h(d,-1)}),j=$('<div class="page next no-select"><span class="icon"></span></div>').insertAfter(d).on("click",function(){h(d,1)});d.parent().hover(function(){d.width()>d.parent().width()&&(d.parent().find(".page.prev").show(),d.parent().find(".page.next").show())},function(){l.hide();j.hide()});lazyImage.lazy(d)}}function h(k,j){var m=870==k.parent().width()?5:4,l=k.data("left")+j*k.children().outerWidth(!0)*m;0>l?l=0!=k.data("left")?0:k.children().length%m?k.width()-k.children().length%m*k.children().outerWidth(!0):k.width()+l:l>=k.width()&&(l=0);k.css({"margin-left":-l,opacity:0}).stop(!0,!0).animate({opacity:1},200);k.data("left",l);lazyImage.lazy(k);return l}function g(d){var c=$('<li><div class="v"><a class="preview" href="/video/av'+d.aid+'/" target="_blank" title="'+d.title+'"><div class="medal"></div><div class="original"></div><div class="border"></div><img data-img="'+d.pic+'" data-alt="'+d.title+'"></a><a href="/video/av'+d.aid+'/" target="_blank" title="'+d.title+'"><div class="t">'+d.title+"</div></a></div></li>");$('<div class="i"><span><i class="b-icon b-icon-v-play"></i>'+utils.formatNum(d.stat.view)+'</span><span><i class="b-icon b-icon-v-dm"></i>'+utils.formatNum(d.stat.danmaku)+"</span></div>").insertAfter(c.find(".t"));d.badgepay&&$('<div class="rm-pay">\u4ed8\u8d39\u89c2\u770b</div>').prependTo(c.find(".preview"));return c}return{create:function(){$(".recommend-area").remove();var a=$('<div class="recommend-area"><div class="b-head"><span class="b-head-t">\u770b\u8fc7\u8be5\u89c6\u9891\u7684\u8fd8\u559c\u6b22</span></div><div class="rm-list-wrp"><ul class="rm-list"><div class="b-loading"></div></ul></div></div>').insertBefore(".v_large .common");f(a.find(".rm-list"),"http://comment.bilibili.com/recommendnew,"+window.aid);return a}}}(),LiveRecommendList=function(){var b='<div class="v-live-recommend"><div class="b-head"><span class="b-head-t">\u5927\u5bb6\u56f4\u89c2\u7684\u76f4\u64ad</span></div><ul class="v-list-live"></ul></div>';return{create:function(){var a=window.topid||$(".nav-menu .m-i.on").attr("data-tid"),f=window.typeid,e;!a||0>$.inArray(parseInt(a),window.tidSet)||(window.liveRecommendXhrDone=function(c){if(0==c.code&&c.data){if($.isArray(c.data)){if(!c.data.length){return}e=c.data[Math.floor(Math.random()*c.data.length)]}else{e=c.data}$(".bangumi-content .ad").length&&$(".bangumi-content").removeClass("v_large");b=$(b).appendTo(".v_small");$('<li><div class="lv-item"><a class="lv-preview" href="'+e.link+'" target="_blank" title="'+e.title+'"><img data-img="'+e.pic+'" alt="'+e.title+'" /><div class="lv-mask"></div><div class="b-icon-live-play"><i class="lv-onair-dot"></i><span class="lv-onair-txt">LIVE</span></div></a><a href="'+e.link+'" target="_blank"><div class="lv-room"><div class="lv-face"><img data-img="'+e.face+'"></div><div class="lv-t" title="'+e.title+'">'+e.title+'</div></div><div class="lv-info"><div class="lv-host" title="'+e.uname+'"><i class="b-icon b-icon-live-host"></i>'+e.uname+'</div><div class="lv-online"><i class="b-icon b-icon-live-online"></i>'+utils.formatNum(e.online)+"</div></div></a></div></li>").appendTo(b.find(".v-list-live"));lazyImage.lazy(b)}},$.ajax({url:"http://live.bilibili.com/bili/LiveRecommend?id="+a+"&tid="+f,dataType:"jsonp",jsonpCallback:"liveRecommendXhrDone",cache:!0}))}}}();(function(){function b(c){this.APIConfig={base:"http://api.bilibili.com",list:{list:"/x/v2/fav/folder",create:"/x/v2/fav/folder/add",add:"/x/v2/fav/video/add","default":"/x/v2/fav/video/favoured"}};this.options=$.extend(!0,{stowed:!1,aid:null,onAdd:function(){},onCreate:function(){}},c);this.template='<div class="fav-wnd" id="fav_wnd"><div class="fav-hd"><i class="b-icon b-icon-a b-icon-stow on"></i><span class="txt">\u6536\u85cf</span><i class="b-icon b-icon-a b-icon-close"></i></div><div class="fav-bd"><div class="fav-new-wrp"><div class="fav-input-wrp"><input class="fav-input" placeholder="\u8bf7\u8f93\u5165\u6536\u85cf\u5939\u540d\u79f0" /><div class="str-count"></div><div class="err-msg"></div></div><div class="fav-new-btns"><button class="fav-btn b-btn" id="new_fav">\u65b0\u5efa\u5e76\u6dfb\u52a0</button><button class="fav-btn fav-btn-cancel">\u53d6\u6d88</button></div></div><div class="fav-tip"></div><div class="fav-list-wrp"><ul class="fav-list"></ul></div><div class="fav-new"><div class="fav-new-placeholder"><span class="txt">\u65b0\u5efa\u6536\u85cf\u5939</span></div></div></div><iframe class="layout" frameborder=0></iframe></div>';this.currentTarget=null;this.$mask=$('<div class="wnd-mask"></div>');this.$wnd=null;this.maxNum=150;this.maxNameLen=15;this._status={ready:0,initializing:1,initialized:2,listLoaded:3};this.status=this._status.ready;this._scrollbarInitialized=this.stowed=!1;this._inFavList=[];this.init()}b.prototype={constructor:b,init:function(){var c=this;$.fn.mCustomScrollbar?(this.createWnd(),this.status=this._status.initialized):(this.status++,$('<link rel="stylesheet" type="text/css" href="http://static.hdslb.com/plugins/mCustomScrollbar/jquery.mCustomScrollbar.min.css" />').appendTo("body"),this._getScript("http://static.hdslb.com/plugins/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js",function(){c.createWnd();c.status++}))},createWnd:function(){var c=this;this.$wnd=$(this.template);this.$listWrp=this.$wnd.find(".fav-list-wrp");this.$list=this.$listWrp.find(".fav-list");this.$input=this.$wnd.find(".fav-input");this.$error=this.$wnd.find(".err-msg");this.$newFav=this.$wnd.find("#new_fav");this.$wnd.on("click",function(d){d.stopPropagation()});this.$wnd.find(".b-icon-close").click(function(){c.close()});this.$wnd.find(".fav-new-placeholder").click(function(){c._toggleNew(!0)});this.$wnd.find(".fav-btn-cancel").click(function(){c._toggleNew(!1)});this._strCount();this.$input.on("keyup",function(a){c._strCount()});this.$newFav.click(function(){c.createAndAddFav()})},show:function(e){this.currentTarget=e=$(e);var g=this;if(this.status>=this._status.initialized){this.$mask.appendTo("body");var f=e.offset().top+e.outerHeight();e=e.offset().left;this.$wnd.appendTo("body").show();f+this.$wnd.outerHeight()>$(window).height()+$(window).scrollTop()&&(f=$(window).height()+$(window).scrollTop()-this.$wnd.outerHeight()-10);this.$wnd.css({top:f,left:e});if(this.status<this._status.listLoaded||this.stowed){this.status=this._status.listLoaded,this.$list.find(".list-item[default]").remove(),this.ajaxGet(null,"list",{},function(c){g.render(c.data)})}this.stowed=!1;this.$wnd.focus();this.$mask.on("click.fav-list",function(){g.close()})}},close:function(){this._toggleNew(!1);this.$mask.remove();this.$wnd.hide()},render:function(d){this.$list.find(".list-item").not("[default]").remove();for(var e=0;e<d.length;e++){this.addToList(d[e])}this._scrollbarInitialized?this.$listWrp.mCustomScrollbar("update"):(this.$listWrp.mCustomScrollbar({axis:"y",scrollInertia:300,mouseWheel:{scrollAmount:100,preventDefault:!0}}),this._scrollbarInitialized=!0)},addToList:function(f,j){var h=this,g=$('<li data-id="'+f.fid+'" class="list-item"><div class="list-item-name">'+f.name+'<div class="fav-count"></div></div></li>');!0===j?g.attr("default",!0).prependTo(this.$list):(g.appendTo(this.$list),this._favNumCount(g,f,j));g.find(".list-item-name").attr("title",f.name);g.on("click",function(){h.ajaxPost(g,"add",{fid:f.fid,aid:h.options.aid},function(a){h._setStow(f.fid);h._trigger("onAdd",h.currentTarget,f)})});return g},createAndAddFav:function(){var d=this,e=this.$input.val();if(!e){return(new MessageBox).show(d.$newFav,"\u8bf7\u586b\u5199\u6536\u85cf\u5939\u540d\u79f0"),!1}if(e.length>this.maxNameLen){return(new MessageBox).show(d.$newFav,"\u6536\u85cf\u5939\u540d\u8d85\u8fc7\u9650\u5236"),!1}d.$newFav.addClass("disabled");this.ajaxPost(this.$newFav,"create",{name:e},function(f){d.$input.val("");d._strCount();var c=f.data.fid,a={name:e,fid:c,count:1};d.addToList(a);d.$listWrp.mCustomScrollbar("update");d._trigger("onCreate",d.currentTarget,a);d.$newFav.removeClass("disabled");d.ajaxPost(d.$newFav,"add",{fid:f.data.fid,aid:d.options.aid},function(g){d._setStow(c);d._trigger("onAdd",d.currentTarget,a)})})},_setStow:function(c){0>$.inArray(c,this._inFavList)&&(this._inFavList.push(c),this.stowed=!0)},_favNumCount:function(e,g,f){e.find(".fav-count").text(g.cur_count+(0==g.state||1==g.state?"":"/"+g.max_count))},_strCount:function(){var f=this.$input,j=f.siblings(".str-count"),h=f.val().replace(/\r\n?/,"\n").length,g=this.maxNameLen;j.html(h+"/"+g);h>g?(j.addClass("error"),f.addClass("error")):(j.removeClass("error"),this._error(null))},_error:function(c){c?(this.$input.addClass("error"),this.$error.text(c).show()):(this.$input.removeClass("error"),this.$error.text("").hide())},ajaxGet:function(){Array.prototype.unshift.call(arguments,"get");return this._ajax.apply(this,arguments)},ajaxPost:function(){Array.prototype.unshift.call(arguments,"post");return this._ajax.apply(this,arguments)},_toggleNew:function(c){c?(this.$wnd.find(".fav-new-wrp").show(),this.$wnd.find(".fav-new-placeholder").hide()):(this.$wnd.find(".fav-new-wrp").hide(),this.$wnd.find(".fav-new-placeholder").show(),this.$input.val(""),this._strCount())},_ajax:function(h,n,m,l,j,k){l={url:this.APIConfig.base+this.APIConfig.list[m],type:h,dataType:"get"==h?"jsonp":"json",data:$.extend(!0,{jsonp:"jsonp"},l),xhrFields:{withCredentials:!0},success:function(c){0==c.code||"default"==m&&c.list?j&&j.apply(this,arguments):n&&(!c.message&&c.code&&(11001==c.code?c.message="\u6536\u85cf\u5939\u540d\u79f0\u8fc7\u957f":11002==c.code?c.message="\u8fbe\u5230\u6700\u5927\u6536\u85cf\u5939\u6570":11005==c.code?c.message="\u89c6\u9891\u6570\u8fbe\u5230\u76ee\u5f55\u6700\u5927\u6536\u85cf\u6570":11006==c.code?c.message="\u5df2\u7ecf\u5b58\u5728\u8be5\u6536\u85cf\u5939":11007==c.code?c.message="\u5df2\u7ecf\u5b58\u5728\u8be5\u89c6\u9891\u4e86":11012==c.code?c.message="\u5df2\u7ecf\u5220\u9664\u8be5\u6536\u85cf\u5939\u4e86":-101==c.code?c.message="\u8d26\u53f7\u672a\u767b\u5f55":-102==c.code?c.message="\u8d26\u53f7\u88ab\u5c01\u505c":-103==c.code&&(c.message="\u60a8\u7684\u8d26\u53f7\u5df2\u7ecf\u88ab\u5c01\u7981")),(new MessageBox).show(n,c.message||"\u64cd\u4f5c\u5931\u8d25",1500))},error:function(){k?k.apply(this,arguments):n&&(new MessageBox).show(n,"\u8bf7\u6c42\u5931\u8d25",1500)}};"post"==h?postJSONLite(l,"addFavCallback"+m):$.ajax(l)},_getScript:function(d,e){$.ajax({type:"GET",url:d,success:e,dataType:"script",cache:!0})},_trigger:function(){var d=Array.prototype.slice.call(arguments,0),e=d.shift();if(this.options[e]){return this.options[e].apply(this,d)}}};return window.FavList=b})();(function(){function b(F,E,D,C){function A(d){var e=this,c=$.Deferred(),a=new MessageBox({margin:8,Overlap:!0,focusShowPos:"down"});UserStatus.isLogin(this)&&(w?a.show(this,v):(t=!0,C?$.ajax({url:"http://www.bilibili.com/activity/account/token",dataType:"json"}).done(function(f){f.code||!f.data?c.reject():$.ajax({url:"/activity/likes/like/"+E+"?oid="+F.lid+"&action="+d,type:"POST",data:{token:f.data}}).done(function(g){c.resolve(g)}).fail(function(){c.reject()})}):$.ajax({url:"/m/mission_vote",data:{aid:D,msid:E,vote:d}}).done(function(f){c.resolve(f)}).fail(function(){c.reject()}),c.done(function(g){var f,k="\u672a\u77e5\u9519\u8bef",h={0:o,"-1":"\u4e0d\u5728\u53ef\u8bc4\u5206\u65f6\u95f4\u5185","-2":"\u8bc4\u5206\u7684\u89c6\u9891\u4e0d\u5b58\u5728","-3":"\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206","-4":"\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206","-5":"\u8bc4\u5206\u6570\u91cf\u4e0d\u6b63\u786e","-6":"\u8bf7\u5148\u767b\u5f55","-7":"\u60a8\u5269\u4f59\u7684\u53ef\u8bc4\u5206\u70b9\u6570\u4e0d\u8db3","-403":null};C?g&&(f=g.code,h["-403"]=g.msg):f=g.toString();h[f]&&(k=h[f]);"0"==f?(w=!0,g="msg",z.find(".score-wrapper").off("mouseleave").find("li").off("hover click").attr("data-extra","default"),z.find(".b-btn-praise").attr("data-status","true").off("click")):(t=!1,g="error");a.show(e,k,1000,g)}).fail(function(){a.show(e,"\u8bf7\u6c42\u5931\u8d25");t=!1})))}if(F&&(!C||0!=F.lid&&null!=F.lid)){var B=$(".activity-wrp"),z=$('<div class="inside-wrp"><div class="left"><div class="l-inside"></div></div><div class="right"></div></div>');B.attr("data-up-name");B.attr("data-up-space");var y,x,o,v,w=!1,t=!1,j=+F.vote_start,H=+F.vote_end,G=Math.floor(window.serverdate/1000);$(".viewbox .v-title").addClass("activity-enabled").find("h1").prepend('<a target="_blank" href="'+F.single+'" title="'+F.theme+'">\u6d3b\u52a8\u4f5c\u54c1</a>');y='<a class="inside-bg" target="_blank" href="'+F.single+'" title="'+F.theme+'"></a>';if(G>=j&&G<=H){B.addClass("act-now"),"1"==F.mission_zan?(o="\u70b9\u8d5e\u6210\u529f",v="\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u70b9\u8fc7\u8d5e",x='<div class="hinter-msg"><b> '+F.theme+" </b> </div>",x+='<div class="b-btn-praise" data-status="false">\u70b9\u8d5e</div>'):"0"==F.mission_zan&&(o="\u8bc4\u5206\u6210\u529f",v="\u60a8\u5df2\u7ecf\u5bf9\u6b64\u89c6\u9891\u8bc4\u8fc7\u5206",x='<div class="hinter-msg"><b> '+F.theme+" </b> </div>",x+='<ul id="user_rate" class="score-wrapper clearfix"><li></li><li></li><li></li><li></li><li></li></ul>')}else{if(G>H){B.addClass("act-end"),x="\u672c\u89c6\u9891\u53c2\u52a0\u8fc7 <b>[ "+F.title+" ]</b> \u6d3b\u52a8\uff0c\u8be5\u6d3b\u52a8\u5df2\u7ed3\u675f~"}else{return}}z.find(".left .l-inside").html(x).end().find(".right").html(y).find(".inside-bg").css("background-image","url("+(F.zantext||"http://static.hdslb.com/images/transparent.gif")+")").end().end();z.appendTo(B);z.find(".score-wrapper").mouseleave(function(){$(this).find("li").attr("data-extra","false")});hoverDelay(z.find(".score-wrapper li"),function(){var d=new MessageBox({margin:8,focusShowPos:"down"}),c=d.show(this,["\u4e00\u822c","\u8fd8\u884c","\u4e0d\u9519","\u5f88\u8d5e","\u60ca\u8273"][$(this).index()],0);c&&(c.css("min-width",0).find(".mini").css("padding","4px 8px").end(),d.setPos());$(this).prevAll().add(this).attr({"data-extra":"opacity","data-status":"true"});$(this).nextAll().attr({"data-extra":"false","data-status":"false"})},null,100);z.find(".score-wrapper li").click(function(){t||A.call(this,($(this).index()+1)*(C?1:2))});z.find(".b-btn-praise").click(function(){t||A.call(this,1)})}}$(document).ready(function(){var a=$(".activity-wrp");if(a.length&&"0"!=a.attr("data-vote")){var h,g=a.attr("data-msid"),f=$.ajax({url:"http://interface.bilibili.com/serverdate.js",cache:!0,dataType:"script"});10000<parseInt(g)?(h=!0,a=$.ajax({url:"http://www.bilibili.com/activity/subject/"+g,data:{aid:window.aid},dataType:"json"})):(h=!1,a=$.ajax({url:"http://www.bilibili.com/plus/mission_vote.php",data:{act:"mission",msid:g},dataType:"json"}));$.when(a,f).done(function(c){if(c[0]&&!c[0].code){c=c[0].data;var d={};h?(d.mission_id=c.id,d.title=c.name,d.theme=c.dic,d.vote_start=c.stime,d.vote_end=c.etime,d.single=c.act_url,d.zantext=c.cover,d.lid=c.lid,1==c.type?d.mission_zan=0:4==c.type&&(d.mission_zan=1)):d=c;b(d,g,window.aid,h)}})}})})();function measureDesc(){var e=$("#v_desc");if(e.length){e.find("a").each(function(h,g){var k=$(g),j=k.html().match(/av([0-9]+)/);j&&(k.attr("data-view",j[1]),bindPOCoins2(k))});var d=$("<div>").width(e.width()).html(e.html()).css({position:"absolute",top:0,left:0,"line-height":e.css("line-height"),"word-break":"break-all","word-wrap":"break-word",visibility:"hidden","white-space":"pre"}).appendTo("body"),f=e.siblings(".v-desc-toggle");parseInt(e.css("max-height"))&&d.height()>parseInt(e.css("max-height"))?f.length?f.show():(f=$("<a><span>\u5c55\u5f00</span></a>").addClass("b-btn b-btn-textonly v-desc-toggle").appendTo(e.parent()),f.on("click",function(){var a=$(this);e.hasClass("open")?(e.removeClass("open"),a.find(">span").text("\u5c55\u5f00")):(e.addClass("open"),a.find(">span").text("\u6536\u8d77"))})):f.length&&f.hide();d.remove()}}function checkLiveState(b){window.liveXhrDone=function(c){c.data&&c.data.status&&$('<a class="live-status-link" href="'+(c.data&&c.data.url)+'" target="_blank"><span>'+["","\u76f4\u64ad\u4e2d","\u8f6e\u64ad\u4e2d"][c.data.status]+"</span></a>").appendTo("#r-info-rank")};$.ajax({url:"http://live.bilibili.com/bili/living_v2/"+b,dataType:"jsonp",cache:!0,jsonpCallback:"liveXhrDone"})}function EmbedPlayer(g,f,k){g={};var j=$("#bofqi").contents().filter(function(){return 3==this.nodeType}),h=j.text().match(/\[flashvars\](.*)\[\/flashvars\]/);null!=h&&(k=k+"&"+h[1],j.remove());k=k.split("&");for(j=0;j<k.length;j++){""!=k[j]&&(h=k[j].split("="),g[h[0]]=h[1])}swfobject.embedSWF(f,"player_placeholder","950","482","0","",g,{bgcolor:"#ffffff",allowfullscreeninteractive:"true",allowfullscreen:"true",quality:"high",allowscriptaccess:"always",wmode:"direct"},{"class":"player"})}function play_use_coop_player(g,f,k){var j=arguments.callee;if(k){var h=f.match(/id_([^.]+)/);h&&($("#bofqi").html('<div id="player_placeholder"></div>'),swfobject.embedSWF("http://static.hdslb.com/youku.swf","player_placeholder","950","482","0","",{"bili-cid":g,url:"http://player.youku.com/player.php/sid/"+h[1]+"/v.swf"},{allowfullscreeninteractive:"true",allowfullscreen:"true",quality:"high",allowscriptaccess:"always",wmode:"direct"},{"class":"player"}))}else{setTimeout(function(){j(g,f,!0)},0)}}$(function(){Responsive.add(function(a){measureDesc()});addReturnToMobile();onLoginInfoLoaded(function(a){var b=$(".v-title-line.fav_btn"),c=b.find("i.b-icon"),d=new Animator({element:c,frameSource:"http://static.hdslb.com/images/base/anim-collect.png",frameWidth:60,frameHeight:60,fps:24,totalFrame:21});b.on("mouseenter.anim",function(){c.hasClass("on")||d.start(1)}).on("mouseleave.anim",function(){d.back()});if(a.isLogin&&window.aid){var e=new FavList({aid:window.aid,onAdd:function(a){this.close();$(".fav_btn").find(".b-icon-stow, .b-icon-anim-fav").addClass("on");$(".fav_btn").find(".stow-status, .t-right-top").html("\u5df2\u6536\u85cf");CacheManager.addItem("last_fav",parseInt(window.aid));d.options.totalFrame=30;d.options.offsetY=60;d.framePos=0;b.off("mouseenter.anim mouseleave.anim");d.start()}});$.get("http://api.bilibili.com/x/v2/fav/video/favoured",{aid:window.aid,jsonp:"jsonp"},function(a){0==a.code&&a.data.favoured&&($(".fav_btn").find(".b-icon-stow, .b-icon-anim-fav").addClass("on"),$(".fav_btn").find(".stow-status, .t-right-top").html("\u5df2\u6536\u85cf"),c.css("background-position","0 -120px"))},"jsonp")}$(".fav_btn, .fav_btn_top").on("click",function(a){if(UserStatus.isLogin($(this))){e&&e.show($(this))}else{return !1}});a=$(".r-info > .f").attr("mid");if("undefined"!=typeof window.AttentionList&&"null"!=typeof window.AttentionList){for(var q=0;q<window.AttentionList.length&&window.AttentionList[q]!=a;q++){}}});$(".upinfo .message").on("click",function(a){$(this);UserStatus.isLogin($(this))||a.preventDefault()});$("#bofqi").length&&RecommendArea.create();LiveRecommendList.create();initToolBar();var a,b,c;window.aid?(a=window.aid,b="arc"):window.tp_id&&(a=window.tp_id,b="topic");if(a&&!window.bbComment){c=new bbFeedback(".comm",b,{autoLoad:!0});$("#load_comment").off("click").removeAttr("onclick").on("click",function(){c.show(a,1)});var d,e=function(a){var b=$("#l_id_"+d,a);0!=b.length&&(setTimeout(function(){$(document).scrollTop(b.offset().top-20)},0),b.parents(".reply").length?$(".re_ta",b).click():$(".huifu",b).click())};(b=window.location.href.match(/#fb,([0-9]+),([0-9]+),([0-9]+),(.+)$/))?(d=b[3],c.show(a,1,d,e)):(b=window.location.href.match(/#reply([0-9]+)$/))?(d=b[1],c.show(a,1,d,e)):c.show(a,1)}if(0<$('iframe[src^="https://secure.bilibili.com"]').size()||0<$('iframe[src^="https://ssl.bilibili.tv"]').size()){window.postMessage?(b=function(a){"https://secure.bilibili.com"!=a.origin&&"https://ssl.bilibili.com"!=a.origin||"secJS:"!=a.data.substr(0,6)||eval(a.data.substr(6));"undefined"!=typeof console&&console.log(a.origin+": "+a.data)},window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent&&window.attachEvent("onmessage",b)):setInterval(function(){if(evalCode=__GetCookie("__secureJS")){__SetCookie("__secureJS",""),eval(evalCode)}},1000)}__GetCookie("bbFrontManager")&&(b=window.aid||"",$('<script type="text/javascript" src="http://static.hdslb.com/js/highcharts.js">\x3c/script>').appendTo("head"),$('<a href="http://manager.bilibili.co/#/archive/modify/'+b+'" class="b-btn w" target=\'_blank\' >\u67e5\u770b\u65e5\u5fd7</a>').appendTo("#newtag"),$('<a href="javascript:;" class="b-btn w">\u5f39\u5e55\u7ba1\u7406</a>').appendTo("#newtag").click(function(){if(0<$(".dm_manage").length){$(".dm_manage").stop().slideToggle()}else{var a=$(this);$.ajax({url:"/html/dm_manage.html",dataType:"html",success:function(b){$(".dm_manage").length||$(b).prependTo(a.closest(".main-inner"))},error:function(){(new MessageBox).show(a,"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5")}})}}));miniPlayer()});window.GetRandomString=function(g){for(var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),k="",j=0;j<g;j++){var h=Math.floor(62*Math.random()),k=k+f[h]}return k};function getDownloadUrl(d){var c="https://itunes.apple.com/cn/app/bi-li-bi-li-dong-hua/id736536022";browser.version.MicroMessenger?c="http://a.app.qq.com/o/simple.jsp?pkgname=tv.danmaku.bili":browser.version.android?c="http://wsdownload.hdslb.net/app/BiliPlayer_bilih5.apk":browser.version.ios?c="https://itunes.apple.com/cn/app/bi-li-bi-li-dong-hua/id736536022":browser.version.windowsphone&&(c="https://www.windowsphone.com/zh-cn/store/purchase/validate?app=75620dee-4a7a-4dae-8677-0d930e05f57e&apptype=regular&offer=3869edb1-e34c-469a-af6e-2c8a7856cb61");d&&($(d).attr("href",c),browser.version.android?$(d).attr("target","_self"):$(d).attr("target","_blank"),!browser.version.android||"360"!=__GetUrlValue("from")&&"undefined"==typeof AndroidWebview||$.getScript("http://openbox.mobilem.360.cn/html/api/js/qstore.js",function(){$(d).click(function(){return qStore&&qStore.fn&&"function"==typeof qStore.fn.download?(qStore.fn.download("1343"),!1):!0})}));return c}function showDownloadPanel(f,e,h,g){window.location.href=getDownloadUrl();return !1}(function(d){function c(P){var O=d(this),N=null,L=!1,M="javascript:void(0);",K=d.extend({id:null,title:"\u8bf7\u5148\u4e0b\u8f7d\u5ba2\u6237\u7aef",content:"\u672c\u529f\u80fd\u7531\u5ba2\u6237\u7aef\u63d0\u4f9b _(:3\u300d\u2220)_",download:!1,aid:null,season_id:null,spid:null,room_id:null,mid:null,isBuffBtn:!1,isbangumi:!1,true_season_id:!1},P),J=Date.parse(new Date)/1000,I=GetRandomString(32),E=5,G=!1,H="bilibili://",F=d('<div class="float-notice"><div class="txt">\u8bf7\u70b9\u51fb\u53f3\u4e0a\u89d2\uff0c\u9009\u62e9\u201c<span>\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00</span>\u201d\uff0c\u518d\u70b9\u6253\u5f00\u5ba2\u6237\u7aef</div><div class="close"></div></div>').on("click",".close",function(){F.hide()}),D={packageName:"tv.danmaku.bilianime",packageUrl:"bilibili://"};browser.version.android&&(D={packageName:"tv.danmaku.bili"});var C=function(){F.appendTo("body").show()};P=function(f,e,g){M=getDownloadUrl();O.unbind("click");O.click(function(){browser.version.weibo?C():showDownloadPanel(f,e);return !1});g||O.click()};var A=function(e){var f=d(".app-link-iframe");f.length||(f=d("<iframe>").addClass("app-link-iframe").css({width:0,height:0}));f.hide().appendTo("body");f.attr("src",e)},B=function(e){function g(b){clearTimeout(N);document.removeEventListener("visibilitychange",g,!1)}var f=+new Date;clearTimeout(N);N=setTimeout(function(){2000>+new Date-f&&("function"==typeof e?e():window.location=e)},1000);d(window).on("blur.applink",function(h){clearTimeout(N);d(window).off("blur.applink")});document.addEventListener("visibilitychange",g)},j=function(){O.attr({href:M,target:"_blank"});browser.version.MicroMessenger?a():browser.version.android&&O.attr({target:"_self"});K.season_id&&K.true_season_id?H="bilibili://bangumi/season/"+K.season_id:K.spid?H=browser.version.android?"bilibili://"+(K.season_id?"bangumi/sp/"+K.spid:"splist/"+K.spid):"bilibili://"+(K.season_id?"bilibili.tv/bangumi?spid="+K.spid:"bilibili.tv/sp?spid="+K.spid):K.aid&&!K.isbangumi?H=browser.version.android?"bilibili://video/"+K.aid:"bilibili://?av="+K.aid:K.aid&&K.isbangumi?H=browser.version.android?"bilibili://video/"+K.aid:"bilibili://bangumi/season/av/"+K.aid:K.room_id?H="bilibili://live/"+K.room_id:K.mid&&(H="bilibili://author/"+K.mid);if(browser.version.windowsphone){O.on("click",function(){A(H)})}else{if(browser.version.android){O.on("click",function(){A(H);browser.version.MicroMessenger?o("appLink",H,function(){B(function(){G?C():z()})}):browser.version.weibo?B(function(){C()}):B(function(){z()});return !1})}else{browser.version.ios&&(O.attr({href:H,target:"_self"}),O.on("click",function(){browser.version.MicroMessenger?o("appLink",H,function(){O.applink(function(){G?C():z()})}):browser.version.weibo?B(function(){C()}):B(function(){z()})}))}}L&&(setTimeout(function(){window.open(M,"_self")},1000),L=!1)},z=function(){showDownloadPanel(K.title,K.content)},a=function(){d.ajax({url:"http://app.bilibili.com/x/display/wechat/sign",type:"get",data:{url:window.location.href,timestamp:J,nonce:I,jsonp:"jsonp"},dataType:"jsonp",success:function(e){e&&0==e.code&&d.getScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js",function(){wx&&(wx.config({beta:!0,debug:!1,appId:"wx108457cda8a1b9f9",nonceStr:I,timestamp:J,signature:e.data,jsApiList:"getInstallState launch3rdApp onMenuShareTimeline onMenuShareAppMessage onMenuShareQQ onMenuShareWeibo onMenuShareQZone".split(" ")}),wx.ready(function(){wx.invoke("getInstallState",D,function(g){for(var f in g){"err_msg"==f&&0<g[f].indexOf("yes")&&(G=!0)}})}))})},error:function(){G=!1}})},o=function(f,e,g){wx?wx.invoke("launch3rdApp",{appID:"wxcb8d4298c6a09bcb",messageExt:e,extInfo:e},function(k){for(var h in k){"err_msg"==h&&("launch_3rdApp:ok"==k[h]?G=!0:"function"==typeof g&&g())}}):0>=E?"function"==typeof g&&g():(E--,setTimeout(function(){o(f,e,g)},300))};K.download?P(K.title,K.content,!0):j()}d.fn.bindApplink=function(b){this.each(function(){c.call(this,b)});return this}})($);$(document).ready(function(){var e=$(".r-info").find(".usname"),d=e.find("a.message").attr("mid"),f=$("#r-info-rank");d&&$.ajax({url:"http://api.bilibili.com/vipinfo/default",data:{type:"jsonp",mid:d,loginid:__GetCookie("DedeUserID")},dataType:"jsonp",jsonCallback:"jsonp_z_vipinfo"}).done(function(a){a&&(!a.code&&a.data)&&(a=a.data,a.vip&&2==a.vip.vipType&&0!=a.vip.vipStatus&&2!=a.vip.vipStatus?e.find("a.name").addClass("b-vip-red"):e.find("a.name").removeClass("b-vip-red"),window.AttentionList=window.AttentionList||[],a.follow&&-1==window.AttentionList.indexOf(d)&&window.AttentionList.push(parseInt(d)),a.following?($(".r-info > .f").text("\u5df2\u5173\u6ce8"),$(".r-info > .f").addClass("on"),bindRIUnattent()):($(".r-info > .f").text("+ \u5173\u6ce8"),bindRIAttent()),$(".r-info > .f").removeClass("hide"),a.archiveCount&&$(".up-video-message .archiveCount").text("\u6295\u7a3f\uff1a"+a.archiveCount),f.find(".legalize-icon").remove(),0==a.official_verify.type?f.append('<div class="legalize-icon legalize-16-1" title="\u4e2a\u4eba\u8ba4\u8bc1"></div>'):1==a.official_verify.type&&f.append('<div class="legalize-icon legalize-16-2" title="\u4f01\u4e1a/\u56e2\u4f53\u8ba4\u8bc1"></div>'))})});